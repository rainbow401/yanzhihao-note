# Oauth2

## 授权码类型的核心

先颁发授权码 `code` 值，再颁发访问令牌 `access_token` 值

1. 在颁发**访问令牌**的同时还会颁发**刷新令牌**` refresh_token `值，这种机制可以在**无须用户参与**的情况下用于生成新的访问令牌。正如我们讲到的小明使用小兔软件的例子，当访问令牌过期的时候，刷新令牌的存在可以大大提高小明使用小兔软件的体验。

2. 授权还要有授权范围，**不能让第三方软件获得比注册时权限范围还大的授权**，也不能获得**超出了用户授权的权限范围**，始终确保**最小权限安全原则**。比如，小明只为小兔软件授予了获取当天订单的权限，那么小兔软件就不能访问小明店铺里面的历史订单数据。

![企业微信20220118-143130](/Users/zhihaoyan/Desktop/笔记/图片/企业微信20220118-143130.png)

## Jwt结构化令牌

### 以上提到的`***_token`皆为Jwt结构化令牌

**JWT**这种结构化体可以分为以下三部分

+ Header 头部｜表示装载令牌类型和算法等信息

+ Payload 数据体｜存放数据，比如用户信息等
+ Signature 签名｜用来验证令牌的合法性

### 令牌示例：

**header.payload.signature**

```` html
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJVU0VSVEVTVCIsImV4cCI6MTU4NDEwNTc5MDcwMywiaWF0IjoxNTg0MTA1OTQ4MzcyfQ1HbleXbvJ_2SW8ry30cXOBGR9FW4oSWBd3PWaWKsEXE
````

### 解析后的令牌:

![企业微信20220118-141857](/Users/zhihaoyan/Desktop/笔记/图片/企业微信20220118-141857.png)

### 为什么要使用JWT？

+ 核心思想：就是用计算代替存储，有些 “时间换空间” 的 “味道。这种经过计算并结构化封装的方式，也减少了**“共享数据库” 因远程调用而带来的网络传输消耗**，所以也有可能是节省时间的。

+ 强制要求了加密，保证了传输过程中的安全性。

+ 使用 JWT 格式的令牌，有助于增强系统的可用性和可伸缩性。



### 令牌生命周期

![企业微信20220118-142910](/Users/zhihaoyan/Desktop/笔记/图片/企业微信20220118-142910.png)



## 资源拥有者凭据许可（password）

![企业微信20220118-145959](/Users/zhihaoyan/Desktop/笔记/图片/企业微信20220118-145959.png)



## 客户端凭据许可（client_credentials）

![企业微信20220118-150105](/Users/zhihaoyan/Desktop/笔记/图片/企业微信20220118-150105.png)

## 隐式许可

![企业微信20220118-150647](/Users/zhihaoyan/Desktop/笔记/图片/企业微信20220118-150647.png)
